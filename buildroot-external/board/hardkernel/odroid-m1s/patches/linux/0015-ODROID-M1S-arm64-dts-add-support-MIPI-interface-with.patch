From 5e7072335ef577e876be141876003953ff10ddec Mon Sep 17 00:00:00 2001
From: Dongjin Kim <tobetter@gmail.com>
Date: Fri, 22 Dec 2023 14:04:09 +0900
Subject: [PATCH] ODROID-M1S: arm64/dts: add support MIPI interface with touch
 screen

Signed-off-by: Dongjin Kim <tobetter@gmail.com>
Change-Id: I8a70525f0e35373aba4473e81c2bb36990b45a22
---
 .../boot/dts/rockchip/rk3566-odroid-m1s.dts   | 102 +++++++++++++++++-
 1 file changed, 101 insertions(+), 1 deletion(-)

diff --git a/arch/arm64/boot/dts/rockchip/rk3566-odroid-m1s.dts b/arch/arm64/boot/dts/rockchip/rk3566-odroid-m1s.dts
index a76a0ca9fb83..ebe0a8d96fd5 100644
--- a/arch/arm64/boot/dts/rockchip/rk3566-odroid-m1s.dts
+++ b/arch/arm64/boot/dts/rockchip/rk3566-odroid-m1s.dts
@@ -26,6 +26,14 @@ aliases {
 		serial1 = &uart0;
 	};
 
+	backlight: backlight {
+		compatible = "pwm-backlight";
+		status = "disabled";
+
+		pwms = <&pwm4 0 25000 0>;
+	};
+
+
 	chosen: chosen {
 		stdout-path = "serial2:1500000n8";
 	};
@@ -48,6 +56,19 @@ gmac1_clkin: external-gmac1-clock {
 		#clock-cells = <0>;
 	};
 
+	lcd_pwren: lcd-pwren {
+		compatible = "regulator-fixed";
+		regulator-name = "lcd_pwren";
+		enable-active-high;
+		gpio = <&gpio0 RK_PC7 GPIO_ACTIVE_HIGH>;
+		pinctrl-names = "default";
+		pinctrl-0 = <&lcd_pwr_en>;
+		regulator-always-on;
+		regulator-boot-on;
+		vin-supply = <&vcc3v3_sys>;
+		status = "okay";
+	};
+
 	leds {
 		compatible = "gpio-leds";
 
@@ -206,7 +227,51 @@ &cpu3 {
 };
 
 &display_subsystem {
-    status = "okay";
+	status = "okay";
+};
+
+&dsi0 {
+	#address-cells = <1>;
+	#size-cells = <0>;
+
+	status = "disabled";
+
+	ports {
+		dsi0_in: port@0 {
+			reg = <0>;
+
+			dsi0_in_vp1: endpoint {
+				remote-endpoint = <&vp1_out_dsi0>;
+			};
+		};
+
+		dsi0_out: port@1 {
+			reg = <1>;
+
+			mipi_out_panel: endpoint {
+				remote-endpoint = <&mipi_in_panel>;
+			};
+		};
+	};
+
+	panel: panel@0 {
+		reg = <0>;
+
+		status = "disabled";
+
+		backlight = <&backlight>;
+		power-supply = <&lcd_pwren>;
+		reset-gpios = <&gpio2 RK_PC6 GPIO_ACTIVE_LOW>;
+
+		pinctrl-names = "default";
+		pinctrl-0 = <&lcd_rst_gpio>;
+
+		port {
+			mipi_in_panel: endpoint {
+				remote-endpoint = <&mipi_out_panel>;
+			};
+		};
+	};
 };
 
 &gmac1 {
@@ -513,6 +578,18 @@ &i2c2 {
 	pinctrl-0 = <&i2c2m1_xfer>;
 	status = "disabled";
 
+	touchscreen: touchscreen {
+		status = "disabled";
+
+		pinctrl-names = "default";
+		pinctrl-0 = <&touch_gpios>;
+
+		interrupt-parent = <&gpio0>;
+		interrupts = <RK_PC4 IRQ_TYPE_LEVEL_LOW>;
+
+		irq-gpios = <&gpio0 RK_PC4 IRQ_TYPE_LEVEL_LOW>;
+		reset-gpios = <&gpio4 RK_PB2 GPIO_ACTIVE_LOW>;
+	};
 };
 
 &i2c3 {
@@ -550,6 +627,22 @@ &pcie2x1 {
 };
 
 &pinctrl {
+	lcd {
+		lcd_pwr_en: lcd-pwr-en {
+			rockchip,pins = <0 RK_PC7 RK_FUNC_GPIO &pcfg_pull_none>;
+		};
+
+		lcd_rst_gpio: lcd-rst-gpio {
+			rockchip,pins = <2 RK_PC6 RK_FUNC_GPIO &pcfg_pull_none>;
+		};
+
+		touch_gpios: touch-gpios {
+			rockchip,pins =
+				<4 RK_PB2 RK_FUNC_GPIO &pcfg_pull_up>,
+				<0 RK_PC4 RK_FUNC_GPIO &pcfg_pull_up>;
+		};
+	};
+
 	leds {
 		led_power_en: led_power_en {
 			rockchip,pins = <0 RK_PC6 RK_FUNC_GPIO &pcfg_pull_none>;
@@ -719,3 +812,10 @@ vp0_out_hdmi: endpoint@ROCKCHIP_VOP2_EP_HDMI0 {
 		remote-endpoint = <&hdmi_in_vp0>;
 	};
 };
+
+&vp1 {
+	vp1_out_dsi0: endpoint@ROCKCHIP_VOP2_EP_MIPI0 {
+		reg = <ROCKCHIP_VOP2_EP_MIPI0>;
+		remote-endpoint = <&dsi0_in_vp1>;
+	};
+};
-- 
2.40.1

